{"id":"bball-playback-2ml","title":"Create TeamStatsRepository for starting lineup access","description":"Create a new repository to encapsulate access to the teamstats table. Currently LineupChangeDetector directly queries this table.\n\nCreate backend/src/database/repositories/TeamStatsRepository.ts:\n\nImplement methods:\n- getStartingLineup(gameId: string): Promise\u003cTeamStatsRecord[]\u003e - returns both teams starting lineups\n- getTeamStats(gameId: string, teamId: string): Promise\u003cTeamStatsRecord | null\u003e\n\n- Add caching for performance (starting lineups don't change)\n- Export singleton instance\n- Add to repository index exports\n\nEstimated scope: ~100 lines","status":"closed","priority":0,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:44:28.018017634-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T18:07:06.849925652-08:00","closed_at":"2026-01-24T18:07:06.849925652-08:00","close_reason":"Created TeamStatsRepository with getTeamStatsForGame, getStartingLineup, getStartingPitcher. Implements ITeamStatsRepository interface, uses 1-hour TTL caching. Added to repository index exports.","dependencies":[{"issue_id":"bball-playback-2ml","depends_on_id":"bball-playback-8b2","type":"blocks","created_at":"2026-01-24T16:21:06.665898924-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-3ft","title":"Add getPlayerName method to PlayerRepository","description":"Add a new method to PlayerRepository that retrieves a player's full name by ID. This is currently duplicated in LineupChangeDetector with direct db access.\n\nAdd to PlayerRepository:\n  async getPlayerName(playerId: string): Promise\u003cstring\u003e\n\n- Use existing player cache for performance\n- Return formatted 'FirstName LastName' string\n- Handle missing players gracefully (return empty string)\n\nThis removes the need for LineupChangeDetector to directly access the database for player names.\n\nEstimated scope: ~30 lines","status":"closed","priority":0,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:44:19.887261916-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T18:02:45.164559002-08:00","closed_at":"2026-01-24T18:02:45.164559002-08:00","close_reason":"Method already implemented: PlayerRepository.getPlayerName() exists and is part of IPlayerRepository interface. Uses cache via getPlayerById, returns fullName. Ready for LineupChangeDetector refactor (61h).","dependencies":[{"issue_id":"bball-playback-3ft","depends_on_id":"bball-playback-8b2","type":"blocks","created_at":"2026-01-24T16:21:06.441938889-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-61h","title":"Refactor LineupChangeDetector to use dependency injection","description":"Refactor the main LineupChangeDetector class to:\n\n1. Accept dependencies via constructor:\n   constructor(\n     private playerRepository: IPlayerRepository,\n     private teamStatsRepository: ITeamStatsRepository,\n     private lineupTrackingService: ILineupTrackingService,\n     gameId: string,\n     sessionId: string,\n     currentPlay: PlayData,\n     nextPlay: PlayData\n   )\n\n2. Remove direct db imports\n3. Use the extracted pure detection functions internally\n4. Use the extracted applier functions\n5. Keep the process() method as the main orchestrator\n6. Implement ILineupChangeDetector interface\n\nThe class becomes a thin orchestrator that coordinates:\n- Fetching data (via injected repositories)\n- Detecting changes (via pure functions)\n- Applying changes (via pure functions)\n- Persisting state (via injected service)\n\nEstimated scope: Reduce from 715 lines to ~200 lines","status":"closed","priority":0,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:44:53.617336432-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T20:04:24.796126193-08:00","closed_at":"2026-01-24T20:04:24.796126193-08:00","close_reason":"Refactored LineupChangeDetector with DI:\n- Created LineupChangeDetectorRefactored using constructor-injected dependencies\n- Created LineupTrackingService implementing ILineupTrackingService\n- Updated LineupPlayerData and LineupChangeData interfaces to match implementation\n- Uses pure detection functions from detectors/\n- Uses pure applier functions from LineupChangeApplier\n- Class is now ~320 lines (down from 715)\n- Original class preserved for backward compatibility during migration","dependencies":[{"issue_id":"bball-playback-61h","depends_on_id":"bball-playback-b9j","type":"blocks","created_at":"2026-01-24T11:45:05.574485375-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-61h","depends_on_id":"bball-playback-3ft","type":"blocks","created_at":"2026-01-24T11:45:05.743907784-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-61h","depends_on_id":"bball-playback-2ml","type":"blocks","created_at":"2026-01-24T11:45:05.907930914-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-61h","depends_on_id":"bball-playback-cz3","type":"blocks","created_at":"2026-01-24T11:45:06.088209934-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-61h","depends_on_id":"bball-playback-6x1","type":"blocks","created_at":"2026-01-24T11:45:06.259138239-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-6x1","title":"Extract LineupChangeApplier as pure functions","description":"Extract the logic that applies detected changes to the lineup state into pure functions.\n\nCreate backend/src/services/game/lineup/LineupChangeApplier.ts:\n\n1. applyChangesToPlayers(players: LineupPlayerData[], changes: LineupChangeData[]): LineupPlayerData[]\n2. applyPitchingChange(players: LineupPlayerData[], change: LineupChangeData): LineupPlayerData[]\n3. applyBatterSubstitution(players: LineupPlayerData[], change: LineupChangeData): LineupPlayerData[]\n4. applyFieldingChange(players: LineupPlayerData[], change: LineupChangeData): LineupPlayerData[]\n5. updateCurrentBatterAndPitcher(players: LineupPlayerData[], nextPlay: PlayData, isHalfInningChange: boolean): LineupPlayerData[]\n6. validateCurrentBatters(players: LineupPlayerData[]): LineupPlayerData[]\n\nAll functions are pure - input data, output new data, no mutations.\n\nEstimated scope: ~250 lines","status":"closed","priority":0,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:44:44.186946173-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T19:59:14.327823012-08:00","closed_at":"2026-01-24T19:59:14.327823012-08:00","close_reason":"Created LineupChangeApplier.ts with pure functions:\n- applyPitchingChange() - applies pitcher swap\n- applyBatterSubstitution() - applies pinch hitter\n- applyFieldingChange() - applies defensive replacement\n- applyChangesToPlayers() - orchestrates all changes\n- updateCurrentBatterAndPitcher() - updates flags for play transition\n- validateCurrentBatters() - ensures exactly one current batter per team\n- isPitcherInLineup(), addPitcherToLineup() - helper functions\n\nAll functions are pure and immutable - input data, output new data.","dependencies":[{"issue_id":"bball-playback-6x1","depends_on_id":"bball-playback-8b2","type":"blocks","created_at":"2026-01-24T16:21:07.116864672-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-74n","title":"Investigate GitHub Dependabot reporting 11 vulnerabilities","description":"GitHub's Dependabot is reporting 11 vulnerabilities (1 high, 8 moderate, 2 low) but local npm audit shows 0.\n\n## GitHub Report\nhttps://github.com/fbasas/bball-playback/security/dependabot\n\n## Possible Causes\n- Different vulnerability databases (GitHub Advisory vs npm)\n- Transitive dependencies not caught by npm audit\n- package-lock.json files that npm doesn't consider\n- Different scanning methods\n\n## Action Required\n1. Visit the Dependabot page to see specific vulnerabilities\n2. Determine if they're real threats or false positives\n3. Fix any genuine vulnerabilities\n4. Consider adding GitHub API check to vulnerability script","status":"open","priority":2,"issue_type":"bug","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T17:53:10.228898659-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T17:53:10.228898659-08:00"}
{"id":"bball-playback-8b2","title":"Write tests for ScoreService","description":"Write tests for ScoreService to ensure accurate score calculation.\n\nCreate backend/src/services/game/score/__tests__/ScoreService.test.ts:\n\nTest cases:\n- Single run scoring\n- Multiple runs per play (grand slam, etc.)\n- Score tracking across innings\n- Half-inning transitions\n- Score after errors\n- Walkoff scenarios\n- First play initialization (0-0)\n- High-scoring innings\n- Extra innings\n\nUse mock ScoreRepository - test the service layer logic.\n\nTarget: 90% coverage on ScoreService\nEstimated scope: ~200 lines of tests","status":"closed","priority":1,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:46:36.380441975-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T17:33:59.742489006-08:00","closed_at":"2026-01-24T17:33:59.742489006-08:00","close_reason":"Tests written with 100% coverage; also refactored to clean DI architecture","dependencies":[{"issue_id":"bball-playback-8b2","depends_on_id":"bball-playback-b9j","type":"blocks","created_at":"2026-01-24T16:21:05.694096261-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-8ke","title":"Write unit tests for LineupChangeApplier","description":"Write comprehensive unit tests for the LineupChangeApplier pure functions.\n\nCreate backend/src/services/game/lineup/__tests__/LineupChangeApplier.test.ts:\n\nTest cases:\n- applyPitchingChange: updates pitcher correctly\n- applyBatterSubstitution: replaces batter in correct position\n- applyFieldingChange: updates fielder at position\n- updateCurrentBatterAndPitcher: handles half-inning correctly\n- updateCurrentBatterAndPitcher: handles same-inning correctly\n- validateCurrentBatters: fixes missing batter\n- validateCurrentBatters: fixes multiple batters\n- applyChangesToPlayers: orchestrates multiple changes\n- Edge cases: empty changes, invalid positions, etc.\n\nTarget: 100% coverage on applier functions\nEstimated scope: ~250 lines of tests","status":"closed","priority":0,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:45:54.17075735-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T20:23:13.961350321-08:00","closed_at":"2026-01-24T20:23:13.961350321-08:00","close_reason":"Created comprehensive unit tests for LineupChangeApplier:\n- applyPitchingChange: 4 tests (replace pitcher, immutability, other teams, missing ID)\n- applyBatterSubstitution: 4 tests (replace batter, clear flags, not found, other teams)\n- applyFieldingChange: 2 tests (replace fielder, position not found)\n- applyChangesToPlayers: 3 tests (multiple changes, empty, unknown types)\n- validateCurrentBatters: 5 tests (set first, keep lowest, multiple teams, no change, empty)\n- isPitcherInLineup: 3 tests (found, not found, wrong team)\n- addPitcherToLineup: 2 tests (add with order, empty lineup)\n- updateCurrentBatterAndPitcher: 7 tests (pitcher flags, needs adding, half-inning, same inning, edge cases)\n\nCoverage: 96% statements, 90% branches, 100% functions","dependencies":[{"issue_id":"bball-playback-8ke","depends_on_id":"bball-playback-6x1","type":"blocks","created_at":"2026-01-24T11:46:21.735838726-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-8lf","title":"Expand route integration tests for nextPlay endpoint","description":"Expand the existing game.integration.test.ts to comprehensively test the nextPlay endpoint.\n\nExpand backend/src/routes/__tests__/game.integration.test.ts:\n\nTest cases for GET /api/game/next/:gameId:\n- Initialization (currentPlay=0) returns correct initial state\n- Initialization creates lineup tracking\n- Regular play progression updates score\n- Outs tracking is correct\n- Baserunner tracking is correct\n- Inning transitions work correctly\n- Half-inning changes work correctly\n- Each announcer style returns valid commentary\n- skipLLM mode returns placeholder text\n- Invalid gameId returns 404\n- Invalid currentPlay returns 400\n- Missing session-id returns 400\n- Database errors are handled gracefully\n- Game end detection works\n- Extra innings work correctly\n\nTarget: All major paths covered\nEstimated scope: ~400 lines of tests","status":"open","priority":1,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:46:46.489645057-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:46:46.489645057-08:00"}
{"id":"bball-playback-8wj","title":"Create GamePlaybackService to extract logic from routes","description":"Move all orchestration logic out of the nextPlay.ts route handler into a dedicated service.\n\nCreate backend/src/services/game/GamePlaybackService.ts:\n\nclass GamePlaybackService extends BaseService {\n  constructor(dependencies: {\n    playDataService: IPlayDataService;\n    baseballStateService: IBaseballStateService;\n    scoreService: IScoreService;\n    commentaryService: ICommentaryService;\n    lineupService: ILineupService;\n    eventTranslator: IEventTranslator;\n  })\n\n  async getNextPlay(\n    gameId: string,\n    sessionId: string,\n    currentPlay: number,\n    options: { skipLLM?: boolean; announcerStyle?: AnnouncerStyle }\n  ): Promise\u003cSimplifiedBaseballState\u003e\n\n  async initializeGame(\n    gameId: string,\n    sessionId: string,\n    options: { skipLLM?: boolean }\n  ): Promise\u003cSimplifiedBaseballState\u003e\n}\n\nRoute becomes thin controller:\nexport const getNextPlay: RequestHandler = async (req, res, next) =\u003e {\n  try {\n    const result = await gamePlaybackService.getNextPlay(...);\n    res.json(result);\n  } catch (error) {\n    next(error);\n  }\n};\n\nEstimated scope: Move ~250 lines from route to service","status":"open","priority":1,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:45:17.266775942-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:45:17.266775942-08:00","dependencies":[{"issue_id":"bball-playback-8wj","depends_on_id":"bball-playback-b9j","type":"blocks","created_at":"2026-01-24T11:48:52.257487818-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-8wj","depends_on_id":"bball-playback-61h","type":"blocks","created_at":"2026-01-24T11:48:52.44513732-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-aas","title":"Create performance benchmark tests","description":"Create performance benchmarks to ensure acceptable response times.\n\nCreate backend/src/__tests__/performance/benchmarks.test.ts:\n\nBenchmarks:\n1. API Response Times\n   - /api/game/next/:gameId without LLM: p95 \u003c 300ms\n   - /api/game/next/:gameId with LLM: p95 \u003c 3000ms\n   - /api/game/init/:gameId: p95 \u003c 500ms\n\n2. Database Query Performance\n   - PlayRepository.fetchPlayData: p95 \u003c 50ms\n   - ScoreRepository.calculateScoreOptimized: p95 \u003c 100ms\n   - PlayerRepository.getPlayersByIds (10 players): p95 \u003c 50ms\n\n3. Cache Performance\n   - Cache hit ratio after warmup: \u003e 80%\n   - Cache miss penalty: \u003c 2x hit time\n\n4. Memory Usage\n   - No memory leaks during 100 play progression\n   - Heap size stays bounded\n\n5. Concurrent Requests\n   - 10 concurrent games: no degradation\n   - Response time stability under load\n\nUse Jest with custom timing assertions.\n\nTarget: All performance thresholds documented and tested\nEstimated scope: ~300 lines of tests","status":"open","priority":3,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:48:14.909321175-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:48:14.909321175-08:00"}
{"id":"bball-playback-b39","title":"Backend release checklist and documentation","description":"Final checklist before declaring backend ready for frontend integration.\n\nChecklist:\n1. Code Coverage\n   - [ ] Overall coverage \u003e= 60%\n   - [ ] Critical path coverage \u003e= 80%\n   - [ ] All pure functions 100% covered\n\n2. Test Results\n   - [ ] All unit tests passing\n   - [ ] All integration tests passing\n   - [ ] 20+ historical games pass regression tests\n   - [ ] Performance benchmarks met\n\n3. Code Quality\n   - [ ] No TypeScript errors\n   - [ ] No ESLint warnings\n   - [ ] All interfaces documented\n   - [ ] API documentation up to date\n\n4. Accuracy Verification\n   - [ ] Final scores match Retrosheet for all test games\n   - [ ] All substitution types detected correctly\n   - [ ] All event types translate correctly\n   - [ ] Inning-by-inning scores accurate\n\n5. Documentation Updates\n   - [ ] API.md updated with all endpoints\n   - [ ] README.md updated with setup instructions\n   - [ ] CHANGELOG.md updated\n   - [ ] Architecture decision records current\n\n6. Pre-release Testing\n   - [ ] Fresh clone and setup works\n   - [ ] All npm scripts work\n   - [ ] Environment variable documentation complete\n\nEstimated scope: Documentation and verification","status":"open","priority":3,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:48:26.173005155-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:48:26.173005155-08:00","dependencies":[{"issue_id":"bball-playback-b39","depends_on_id":"bball-playback-sqe","type":"blocks","created_at":"2026-01-24T11:48:50.422697086-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-b39","depends_on_id":"bball-playback-8ke","type":"blocks","created_at":"2026-01-24T11:48:50.593014392-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-b39","depends_on_id":"bball-playback-ro2","type":"blocks","created_at":"2026-01-24T11:48:50.745723388-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-b39","depends_on_id":"bball-playback-8b2","type":"blocks","created_at":"2026-01-24T11:48:50.916630718-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-b39","depends_on_id":"bball-playback-8lf","type":"blocks","created_at":"2026-01-24T11:48:51.081210742-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-b39","depends_on_id":"bball-playback-i88","type":"blocks","created_at":"2026-01-24T11:48:51.240337875-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-b39","depends_on_id":"bball-playback-lh4","type":"blocks","created_at":"2026-01-24T11:48:51.403327895-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-b39","depends_on_id":"bball-playback-s0z","type":"blocks","created_at":"2026-01-24T11:48:51.57232243-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-b39","depends_on_id":"bball-playback-g8u","type":"blocks","created_at":"2026-01-24T11:48:51.764045226-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-b39","depends_on_id":"bball-playback-rk0","type":"blocks","created_at":"2026-01-24T11:48:51.924799969-08:00","created_by":"Fred Basas"},{"issue_id":"bball-playback-b39","depends_on_id":"bball-playback-aas","type":"blocks","created_at":"2026-01-24T11:48:52.091783574-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-b9j","title":"Define service interfaces for dependency injection","description":"Create TypeScript interfaces for all major services to enable clean mocking and dependency injection.\n\nCreate backend/src/services/interfaces/index.ts with:\n- IPlayerService - getPlayerById, getPlayersByIds, getPlayerName\n- IPlayerRepository - findById, findByIds, getPlayerName (NEW method)\n- ITeamStatsRepository - getStartingLineup (NEW)\n- ILineupTrackingService - getLatestLineupState, saveLineupState, saveInitialLineup\n- IScoreService - calculateScore, calculateScoreOptimized\n- IPlayDataService - fetchPlayData, fetchFirstPlay, fetchPlayForBatter\n- ICommentaryService - generateDetailedPlayCompletion\n- ILineupChangeDetector - process, getChanges\n- IGamePlaybackService - getNextPlay, initializeGame\n\nUpdate existing services to implement these interfaces.\n\nEstimated scope: ~200 lines of interface definitions","status":"closed","priority":0,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:44:12.776729387-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T16:42:18.855872316-08:00","closed_at":"2026-01-24T16:42:18.855872316-08:00","close_reason":"Created interfaces in backend/src/services/interfaces/index.ts"}
{"id":"bball-playback-cz3","title":"Extract pure detection functions from LineupChangeDetector","description":"Extract the core detection logic from LineupChangeDetector into pure functions that are trivially testable without mocking.\n\nCreate backend/src/services/game/lineup/detectors/:\n\n1. PitchingChangeDetector.ts:\n   export function detectPitchingChange(\n     currentPlay: PlayData,\n     nextPlay: PlayData,\n     isHalfInningChange: boolean\n   ): PitchingChange | null\n\n2. BatterChangeDetector.ts:\n   export function detectBatterChange(\n     currentBattingOrder: LineupPlayerData[],\n     nextBatter: string,\n     battingTeamId: string\n   ): BatterChange | null\n\n3. FieldingChangeDetector.ts:\n   export function detectFieldingChanges(\n     currentPlay: PlayData,\n     nextPlay: PlayData,\n     isHalfInningChange: boolean\n   ): FieldingChange[]\n\nThese pure functions take data in, return results out - no side effects, no database access.\n\nEstimated scope: ~200 lines across 3 files","status":"closed","priority":0,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:44:36.958835221-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T18:18:21.130348004-08:00","closed_at":"2026-01-24T18:18:21.130348004-08:00","close_reason":"Created 3 pure detection functions in backend/src/services/game/lineup/detectors/:\n- PitchingChangeDetector.ts: detectPitchingChange()\n- BatterChangeDetector.ts: detectBatterChange(), determineExpectedNextBatter(), isPlayerInLineup()\n- FieldingChangeDetector.ts: detectFieldingChanges()\nPlus types.ts with PitchingChange, BatterChange, FieldingChange interfaces.\nAll pure functions - data in, result out, no side effects.","dependencies":[{"issue_id":"bball-playback-cz3","depends_on_id":"bball-playback-8b2","type":"blocks","created_at":"2026-01-24T16:21:06.885866418-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-e6f","title":"Fix CRITICAL vulnerability: form-data unsafe random function","description":"Dependabot Alert: form-data uses unsafe random function for choosing boundary.\n\nSeverity: CRITICAL\n\nAction required:\n- Update form-data to a patched version\n- Check if axios (which depends on form-data) needs updating\n- Run npm audit fix or manually update package.json\n\nThis is the highest priority security fix needed.\n\nReference: https://github.com/fbasas/bball-playback/security/dependabot","status":"closed","priority":0,"issue_type":"bug","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:56:55.619924124-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T16:15:30.382565785-08:00","closed_at":"2026-01-24T16:15:30.382565785-08:00","close_reason":"Fixed via npm audit fix"}
{"id":"bball-playback-g0w","title":"Fix event translation parsing bugs (7 failing tests)","description":"The translateEvent.test.ts has 7 failing tests due to parsing logic issues:\n\n1. **Stolen base parsing** - `SB2` returns `S` (single) instead of `SB`\n2. **Fielder-to-fielder plays** - `31` returns empty primaryEventType instead of `G`\n3. **Double play parsing** - `643` not recognized as ground out\n4. **Translation mismatches**:\n   - `G63` translates to 'Groundout to shortstop' instead of 'Grounded into a 6-3 double play'\n   - `SB2` translates to 'Single' instead of 'Stole second base'\n   - `31` translates to 'Unknown play' instead of 'Groundout to first baseman, throw to pitcher'\n   - `G6` translation mismatch\n\nFiles involved:\n- src/services/eventTranslation/translateEvent.ts (parsing logic)\n- src/services/eventTranslation/translateEvent.test.ts (tests)\n\nEither fix the parsing logic to match expected behavior, or update tests if the current behavior is intentional.","status":"open","priority":1,"issue_type":"bug","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T18:45:41.443792818-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T18:45:41.443792818-08:00"}
{"id":"bball-playback-g8u","title":"Write validation schema tests","description":"Write tests for Zod validation schemas to ensure data integrity.\n\nCreate backend/src/validation/__tests__/schemas.test.ts:\n\nTest all schemas:\n1. BaseballStateSchema\n   - Valid state passes\n   - Missing required fields fail\n   - Invalid types fail\n   - Nested object validation\n\n2. PlayDataSchema\n   - All required fields validated\n   - Optional fields handled\n   - Type coercion behavior\n\n3. Query parameter schemas\n   - gameId validation\n   - currentPlay as number\n   - announcerStyle enum values\n   - Invalid values rejected\n\n4. Request body schemas\n   - CreateGameRequest validation\n   - Empty body handling\n\n5. Edge cases\n   - Null vs undefined handling\n   - Empty strings\n   - Numeric strings\n\nTarget: All schemas have tests\nEstimated scope: ~300 lines of tests","status":"open","priority":2,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:47:55.641657177-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:47:55.641657177-08:00"}
{"id":"bball-playback-i4g","title":"Fix LOW severity vulnerabilities: diff, tmp, brace-expansion, vite","description":"Dependabot Alerts - LOW severity:\n\n1. diff (jsdiff) - DoS vulnerability in parsePatch and applyPatch\n2. tmp (x2) - Arbitrary file write via symbolic link dir parameter\n3. brace-expansion (x2) - Regular Expression Denial of Service\n4. vite (x2) - server.fs settings not applied to HTML files, middleware file serving issues\n\nActions:\n- Update diff to patched version\n- Update tmp to patched version\n- Update brace-expansion (likely transitive dependency)\n- Vite issues may be fixed by medium-priority vite update\n\nThese are lower priority but should be addressed for security hygiene.\n\nReference: https://github.com/fbasas/bball-playback/security/dependabot","status":"open","priority":3,"issue_type":"bug","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:57:19.385002263-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:57:19.385002263-08:00"}
{"id":"bball-playback-i88","title":"Create historical game regression test framework","description":"Create a framework for running full historical games and validating accuracy against known results.\n\nCreate backend/src/__tests__/e2e/gamePlaythrough.test.ts:\n\nFramework features:\n1. Load a known historical game\n2. Play through all plays sequentially\n3. At game end, verify:\n   - Final score matches Retrosheet data\n   - Total hits match\n   - All substitutions were detected\n   - Inning-by-inning scores match\n   - Play count matches\n\nTest games to include:\n- NYA202410300 (World Series Game 5) - already used in manual tests\n- Game with many substitutions\n- High-scoring game (10+ runs)\n- Extra innings game\n- Low-hit game (no-hitter or 1-hitter)\n\nCreate helper utilities:\n- loadExpectedGameResults(gameId) - loads expected data from fixtures\n- compareGameResults(actual, expected) - detailed comparison\n- generateGameReport(gameId) - human-readable test report\n\nEstimated scope: ~500 lines (framework + 5 game tests)","status":"open","priority":1,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:46:58.305223531-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:46:58.305223531-08:00"}
{"id":"bball-playback-lh4","title":"Expand event translation test coverage","description":"Expand the existing translateEvent.test.ts to cover all Retrosheet event types.\n\nExpand backend/src/services/eventTranslation/tests/translateEvent.test.ts:\n\nEnsure coverage for ALL event types:\n- Singles (S1-S9, S, S/G, etc.)\n- Doubles (D1-D9, DGR, etc.)\n- Triples (T1-T9)\n- Home runs (HR, HR7, HR89, H/L, etc.)\n- Groundouts (all positions 1-9)\n- Flyouts (all positions 1-9)\n- Lineouts (all positions 1-9)\n- Popouts\n- Strikeouts (K, K23, K+SB2, etc.)\n- Walks (W, IW, W+SB2, etc.)\n- Hit by pitch (HP)\n- Errors (E1-E9, combinations)\n- Fielder's choice (FC1-FC9)\n- Stolen bases (SB2, SB3, SBH)\n- Caught stealing (CS2, CS3, CSH)\n- Wild pitches (WP)\n- Passed balls (PB)\n- Balks (BK)\n- Double plays (GDP, LDP, etc.)\n- Triple plays\n- Sacrifice hits (SH)\n- Sacrifice flies (SF)\n- Interference\n- Catcher's interference\n\nCreate matrix of all event types from Retrosheet documentation.\n\nTarget: 100% event type coverage\nEstimated scope: ~600 lines of tests","status":"open","priority":2,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:47:10.775238609-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:47:10.775238609-08:00"}
{"id":"bball-playback-ly2","title":"Fix HIGH severity vulnerabilities: axios, glob, qs","description":"Dependabot Alerts - HIGH severity:\n\n1. axios - DoS attack through lack of data size check\n2. glob - Command injection via -c/--cmd executes matches with shell:true  \n3. qs - arrayLimit bypass in bracket notation allows DoS via memory exhaustion\n\nActions:\n- Update axios to latest version\n- Update glob to patched version\n- Update qs to patched version\n- Run npm audit to verify fixes\n- Test that application still works after updates\n\nReference: https://github.com/fbasas/bball-playback/security/dependabot","status":"closed","priority":1,"issue_type":"bug","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:57:02.204385001-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T16:15:30.391533258-08:00","closed_at":"2026-01-24T16:15:30.391533258-08:00","close_reason":"Fixed via npm audit fix"}
{"id":"bball-playback-n0p","title":"Fix MEDIUM severity vulnerabilities: lodash, vite, js-yaml","description":"Dependabot Alerts - MEDIUM severity:\n\n1. lodash (x3) - Prototype Pollution Vulnerability in _.unset and _.omit functions\n2. vite (x5) - Multiple server.fs.deny bypass vulnerabilities\n3. js-yaml - Prototype pollution in merge (\u003c\u003c)\n\nActions:\n- Update lodash to latest version (or remove if not directly used)\n- Update vite to latest version\n- Update js-yaml to patched version\n- Run npm audit to verify fixes\n- Test dev server and build process after vite update\n\nNote: Some lodash vulnerabilities may be from transitive dependencies.\n\nReference: https://github.com/fbasas/bball-playback/security/dependabot","status":"open","priority":2,"issue_type":"bug","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:57:10.760310737-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:57:10.760310737-08:00"}
{"id":"bball-playback-qao","title":"Create ServiceFactory for consistent dependency injection","description":"Create a service factory to manage service instantiation and enable easy mocking in tests.\n\nCreate backend/src/services/ServiceFactory.ts:\n\nclass ServiceFactory {\n  private static instances: Map\u003cstring, any\u003e = new Map();\n\n  static getPlayerService(): IPlayerService\n  static getScoreService(): IScoreService\n  static getPlayDataService(): IPlayDataService\n  static getBaseballStateService(): IBaseballStateService\n  static getCommentaryService(): ICommentaryService\n  static getLineupService(): ILineupService\n  static getGamePlaybackService(): IGamePlaybackService\n\n  // For testing: reset all instances\n  static resetAll(): void\n\n  // For testing: inject mock\n  static setMock\u003cT\u003e(name: string, mock: T): void\n}\n\nBenefits:\n- Single place to configure all service dependencies\n- Easy test setup with setMock()\n- Clear singleton management\n- Removes static method pattern from individual services\n\nEstimated scope: ~150 lines","status":"open","priority":1,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:45:31.346546519-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:45:31.346546519-08:00","dependencies":[{"issue_id":"bball-playback-qao","depends_on_id":"bball-playback-b9j","type":"blocks","created_at":"2026-01-24T11:48:52.606529749-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-rk0","title":"Write error handling and edge case tests","description":"Write tests for error handling paths and edge cases.\n\nCreate backend/src/__tests__/error-handling.test.ts:\n\nTest scenarios:\n1. Database connection failures\n   - Connection timeout\n   - Query timeout\n   - Connection pool exhaustion\n\n2. OpenAI API failures\n   - API timeout\n   - Rate limiting (429)\n   - Invalid API key\n   - Network errors\n   - Graceful fallback with skipLLM\n\n3. Invalid data in database\n   - Malformed event strings\n   - Missing required fields\n   - Null where not expected\n\n4. Request validation failures\n   - Missing gameId\n   - Invalid currentPlay format\n   - Missing session-id header\n   - Invalid announcerStyle\n\n5. Game edge cases\n   - Game with 0 plays\n   - Game already at last play\n   - Suspended/rainout games\n   - Double-headers\n\nTarget: All error paths tested\nEstimated scope: ~400 lines of tests","status":"open","priority":2,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:48:04.55062855-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:48:04.55062855-08:00"}
{"id":"bball-playback-ro2","title":"Write integration tests for LineupChangeDetector","description":"Write integration tests for the refactored LineupChangeDetector using mocked dependencies.\n\nCreate backend/src/services/game/__tests__/LineupChangeDetector.test.ts:\n\nTest cases:\n- Constructor accepts all dependencies\n- process() initializes lineup when no state exists\n- process() detects and saves pitching changes\n- process() detects and saves batter substitutions\n- process() detects and saves fielding changes\n- process() handles half-inning transitions correctly\n- process() updates current batter progression\n- Error handling: missing player data\n- Error handling: database errors\n- Full game simulation with known substitutions\n\nUse mock repositories and services - no real database needed.\n\nTarget: 80% coverage on LineupChangeDetector\nEstimated scope: ~400 lines of tests","status":"open","priority":1,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:46:21.931842555-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T11:46:21.931842555-08:00","dependencies":[{"issue_id":"bball-playback-ro2","depends_on_id":"bball-playback-61h","type":"blocks","created_at":"2026-01-24T11:46:36.188902172-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-s0z","title":"Write repository integration tests with test database","description":"Create integration tests for repositories using real Retrosheet data (read-only).\n\nTest approach:\n- Use real production database connection (read-only queries)\n- Test against known historical games with predictable data\n- No fixtures needed - Retrosheet data is immutable\n\nCreate tests:\n1. backend/src/database/repositories/__tests__/PlayRepository.integration.test.ts\n   - fetchFirstPlay returns correct data for known game\n   - fetchPlayData returns current and next play\n   - Query performance is acceptable (\u003c100ms)\n\n2. backend/src/database/repositories/__tests__/PlayerRepository.integration.test.ts\n   - getPlayerById returns known player data\n   - getPlayersByIds returns multiple players\n   - getPlayerName returns formatted name\n\n3. backend/src/database/repositories/__tests__/ScoreRepository.integration.test.ts\n   - getRunsForTeam returns correct scores for known game\n   - Score accumulation across innings matches box score\n\n4. backend/src/database/repositories/__tests__/TeamStatsRepository.integration.test.ts\n   - getTeamStatsForGame returns both teams\n   - getStartingLineup returns 9 batters + pitcher\n\nTest game candidates:\n- Pick a well-documented game with known box score\n- Use game ID as constant in test setup\n\nEstimated scope: ~400 lines of tests","status":"open","priority":2,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:47:19.905268749-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T18:10:10.095799281-08:00","dependencies":[{"issue_id":"bball-playback-s0z","depends_on_id":"bball-playback-2ml","type":"blocks","created_at":"2026-01-24T11:47:55.465226244-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-sqe","title":"Write unit tests for pure detection functions","description":"Write comprehensive unit tests for the extracted pure detection functions. These are trivially testable since they have no dependencies.\n\nCreate tests:\n1. backend/src/services/game/lineup/detectors/__tests__/PitchingChangeDetector.test.ts\n   - Test mid-inning pitcher change detection\n   - Test half-inning change (should return null)\n   - Test same pitcher (should return null)\n   - Test edge cases\n\n2. backend/src/services/game/lineup/detectors/__tests__/BatterChangeDetector.test.ts\n   - Test pinch hitter detection\n   - Test normal batting order progression\n   - Test player already in lineup\n   - Test edge cases\n\n3. backend/src/services/game/lineup/detectors/__tests__/FieldingChangeDetector.test.ts\n   - Test position changes at each position (2-9)\n   - Test half-inning change (should return empty)\n   - Test no changes\n   - Test multiple changes in same play\n\nTarget: 100% coverage on pure functions\nEstimated scope: ~300 lines of tests","status":"closed","priority":0,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T11:45:41.448759891-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T20:09:23.816075383-08:00","closed_at":"2026-01-24T20:09:23.816075383-08:00","close_reason":"Created comprehensive unit tests for pure detection functions:\n- PitchingChangeDetector.test.ts: 10 tests covering mid-inning changes, half-inning changes, same pitcher, edge cases\n- BatterChangeDetector.test.ts: 14 tests covering pinch hitters, normal progression, already-in-lineup, edge cases\n- FieldingChangeDetector.test.ts: 16 tests covering all positions 2-9, multiple changes, half-inning, edge cases\n\nCoverage: 100% on all detector files (BatterChangeDetector, FieldingChangeDetector, PitchingChangeDetector, types)","dependencies":[{"issue_id":"bball-playback-sqe","depends_on_id":"bball-playback-cz3","type":"blocks","created_at":"2026-01-24T11:45:53.986246516-08:00","created_by":"Fred Basas"}]}
{"id":"bball-playback-tsv","title":"Clean up empty test files causing test suite failures","description":"Three files are causing 'test suite must contain at least one test' errors:\n\n1. src/config/environments/test.ts - likely misnamed (not a test file)\n2. src/routes/test.ts - likely misnamed (not a test file)  \n3. src/services/eventTranslation/tests/translateEvent.test.ts - empty/duplicate test file\n\nOptions:\n- Rename non-test files to not match *.test.ts pattern\n- Add actual tests to empty test files\n- Delete duplicate/empty test files\n\nThis will reduce noise in test output and fix 3 of the 5 failing test suites.","status":"open","priority":2,"issue_type":"task","owner":"fmb@alum.mit.edu","created_at":"2026-01-24T18:45:45.787385123-08:00","created_by":"Fred Basas","updated_at":"2026-01-24T18:45:45.787385123-08:00"}
